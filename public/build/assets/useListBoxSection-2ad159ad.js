import{g as T,i as I,h as L,f as R}from"./SelectionManager-72778fb6.js";import{r as k,o as q,A as j,B as G}from"./app-1e18f165.js";import{d as z,$ as V,q as O,a as J,f as B}from"./focusSafely-0d0e41b4.js";import{a as W,b as Q}from"./useFocusable-37bc966c.js";import{$ as X}from"./useLabel-5cfcb98f.js";import{d as Y,e as Z}from"./useMenuTriggerState-2cd95046.js";import{$ as _}from"./useHover-fbcb60c8.js";class D{*[Symbol.iterator](){yield*this.iterable}get size(){return this.keyMap.size}getKeys(){return this.keyMap.keys()}getKeyBefore(l){let t=this.keyMap.get(l);var o;return t&&(o=t.prevKey)!==null&&o!==void 0?o:null}getKeyAfter(l){let t=this.keyMap.get(l);var o;return t&&(o=t.nextKey)!==null&&o!==void 0?o:null}getFirstKey(){return this.firstKey}getLastKey(){return this.lastKey}getItem(l){var t;return(t=this.keyMap.get(l))!==null&&t!==void 0?t:null}at(l){const t=[...this.getKeys()];return this.getItem(t[l])}getChildren(l){let t=this.keyMap.get(l);return(t==null?void 0:t.childNodes)||[]}constructor(l){this.keyMap=new Map,this.firstKey=null,this.lastKey=null,this.iterable=l;let t=i=>{if(this.keyMap.set(i.key,i),i.childNodes&&i.type==="section")for(let n of i.childNodes)t(n)};for(let i of l)t(i);let o=null,$=0;for(let[i,n]of this.keyMap)o?(o.nextKey=i,n.prevKey=o.key):(this.firstKey=i,n.prevKey=void 0),n.type==="item"&&(n.index=$++),o=n,o.nextKey=void 0;var a;this.lastKey=(a=o==null?void 0:o.key)!==null&&a!==void 0?a:null}}function re(e){let{filter:l,layoutDelegate:t}=e,o=T(e),$=k.useMemo(()=>e.disabledKeys?new Set(e.disabledKeys):new Set,[e.disabledKeys]),a=k.useCallback(v=>l?new D(l(v)):new D(v),[l]),i=k.useMemo(()=>({suppressTextValueWarning:e.suppressTextValueWarning}),[e.suppressTextValueWarning]),n=I(e,a,i),c=k.useMemo(()=>new L(n,o,{layoutDelegate:t}),[n,o,t]);const f=k.useRef(null);return k.useEffect(()=>{if(o.focusedKey!=null&&!n.getItem(o.focusedKey)&&f.current){const d=f.current.getItem(o.focusedKey),K=[...f.current.getKeys()].map(p=>{const b=f.current.getItem(p);return(b==null?void 0:b.type)==="item"?b:null}).filter(p=>p!==null),u=[...n.getKeys()].map(p=>{const b=n.getItem(p);return(b==null?void 0:b.type)==="item"?b:null}).filter(p=>p!==null);var v,h;const F=((v=K==null?void 0:K.length)!==null&&v!==void 0?v:0)-((h=u==null?void 0:u.length)!==null&&h!==void 0?h:0);var x,y,m;let r=Math.min(F>1?Math.max(((x=d==null?void 0:d.index)!==null&&x!==void 0?x:0)-F+1,0):(y=d==null?void 0:d.index)!==null&&y!==void 0?y:0,((m=u==null?void 0:u.length)!==null&&m!==void 0?m:0)-1),s=null,S=!1;for(;r>=0;){if(!c.isDisabled(u[r].key)){s=u[r];break}if(r<u.length-1&&!S)r++;else{S=!0;var g,M;r>((g=d==null?void 0:d.index)!==null&&g!==void 0?g:0)&&(r=(M=d==null?void 0:d.index)!==null&&M!==void 0?M:0),r--}}o.setFocusedKey(s?s.key:null)}f.current=n},[n,c,o,o.focusedKey]),{collection:n,disabledKeys:$,selectionManager:c}}const w=new WeakMap;function ee(e){return typeof e=="string"?e.replace(/\s*/g,""):""+e}function le(e,l){let t=w.get(e);if(!t)throw new Error("Unknown list");return`${t.id}-option-${ee(l)}`}function ue(e,l,t){let o=W(e,{labelable:!0}),$=e.selectionBehavior||"toggle",a=e.linkBehavior||($==="replace"?"action":"override");$==="toggle"&&a==="action"&&(a="override");let{listProps:i}=Y({...e,ref:t,selectionManager:l.selectionManager,collection:l.collection,disabledKeys:l.disabledKeys,linkBehavior:a}),{focusWithinProps:n}=Q({onFocusWithin:e.onFocus,onBlurWithin:e.onBlur,onFocusWithinChange:e.onFocusChange}),c=z(e.id);w.set(l,{id:c,shouldUseVirtualFocus:e.shouldUseVirtualFocus,shouldSelectOnPressUp:e.shouldSelectOnPressUp,shouldFocusOnHover:e.shouldFocusOnHover,isVirtualized:e.isVirtualized,onAction:e.onAction,linkBehavior:a});let{labelProps:f,fieldProps:v}=X({...e,id:c,labelElementType:"span"});return{labelProps:f,listBoxProps:V(o,n,l.selectionManager.selectionMode==="multiple"?{"aria-multiselectable":"true"}:{},{role:"listbox",...V(v,i)})}}function ce(e,l,t){var o,$;let{key:a}=e,i=w.get(l);var n;let c=(n=e.isDisabled)!==null&&n!==void 0?n:l.selectionManager.isDisabled(a);var f;let v=(f=e.isSelected)!==null&&f!==void 0?f:l.selectionManager.isSelected(a);var h;let x=(h=e.shouldSelectOnPressUp)!==null&&h!==void 0?h:i==null?void 0:i.shouldSelectOnPressUp;var y;let m=(y=e.shouldFocusOnHover)!==null&&y!==void 0?y:i==null?void 0:i.shouldFocusOnHover;var g;let M=(g=e.shouldUseVirtualFocus)!==null&&g!==void 0?g:i==null?void 0:i.shouldUseVirtualFocus;var d;let K=(d=e.isVirtualized)!==null&&d!==void 0?d:i==null?void 0:i.isVirtualized,u=O(),F=O(),r={role:"option","aria-disabled":c||void 0,"aria-selected":l.selectionManager.selectionMode!=="none"?v:void 0};q()&&j()||(r["aria-label"]=e["aria-label"],r["aria-labelledby"]=u,r["aria-describedby"]=F);let s=l.collection.getItem(a);if(K){let P=Number(s==null?void 0:s.index);r["aria-posinset"]=Number.isNaN(P)?void 0:P+1,r["aria-setsize"]=Z(l.collection)}let S=i!=null&&i.onAction?()=>{var P;return i==null||(P=i.onAction)===null||P===void 0?void 0:P.call(i,a)}:void 0,{itemProps:p,isPressed:b,isFocused:U,hasAction:H,allowsSelection:N}=R({selectionManager:l.selectionManager,key:a,ref:t,shouldSelectOnPressUp:x,allowsDifferentPressOrigin:x&&m,isVirtualized:K,shouldUseVirtualFocus:M,isDisabled:c,onAction:S||!(s==null||(o=s.props)===null||o===void 0)&&o.onAction?J(s==null||($=s.props)===null||$===void 0?void 0:$.onAction,S):void 0,linkBehavior:i==null?void 0:i.linkBehavior}),{hoverProps:C}=_({isDisabled:c||!m,onHoverStart(){B()||(l.selectionManager.setFocused(!0),l.selectionManager.setFocusedKey(a))}}),A=W(s==null?void 0:s.props);delete A.id;let E=G(s==null?void 0:s.props);return{optionProps:{...r,...V(A,p,C,E),id:le(l,a)},labelProps:{id:u},descriptionProps:{id:F},isFocused:U,isFocusVisible:U&&B(),isSelected:v,isDisabled:c,isPressed:b,allowsSelection:N,hasAction:H}}function fe(e){let{heading:l,"aria-label":t}=e,o=z();return{itemProps:{role:"presentation"},headingProps:l?{id:o,role:"presentation"}:{},groupProps:{role:"group","aria-label":t,"aria-labelledby":l?o:void 0}}}export{re as $,ue as a,ce as b,fe as c};
