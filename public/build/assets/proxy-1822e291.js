import{r as e,M as S,j as x,v as I}from"./app-1e18f165.js";import{P as b,u as A,a as D,L as B,l as z,b as K,c as O,d as T}from"./create-factory-27ee3d52.js";class U extends e.Component{getSnapshotBeforeUpdate(s){const t=this.props.childRef.current;if(t&&s.isPresent&&!this.props.isPresent){const n=this.props.sizeRef.current;n.height=t.offsetHeight||0,n.width=t.offsetWidth||0,n.top=t.offsetTop,n.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function G({children:o,isPresent:s}){const t=e.useId(),n=e.useRef(null),f=e.useRef({width:0,height:0,top:0,left:0}),{nonce:l}=e.useContext(S);return e.useInsertionEffect(()=>{const{width:u,height:i,top:p,left:r}=f.current;if(s||!n.current||!u||!i)return;n.current.dataset.motionPopId=t;const d=document.createElement("style");return l&&(d.nonce=l),document.head.appendChild(d),d.sheet&&d.sheet.insertRule(`
          [data-motion-pop-id="${t}"] {
            position: absolute !important;
            width: ${u}px !important;
            height: ${i}px !important;
            top: ${p}px !important;
            left: ${r}px !important;
          }
        `),()=>{document.head.removeChild(d)}},[s]),x.jsx(U,{isPresent:s,childRef:n,sizeRef:f,children:e.cloneElement(o,{ref:n})})}const H=({children:o,initial:s,isPresent:t,onExitComplete:n,custom:f,presenceAffectsLayout:l,mode:u})=>{const i=I(V),p=e.useId(),r=e.useCallback(h=>{i.set(h,!0);for(const y of i.values())if(!y)return;n&&n()},[i,n]),d=e.useMemo(()=>({id:p,initial:s,isPresent:t,custom:f,onExitComplete:r,register:h=>(i.set(h,!1),()=>i.delete(h))}),l?[Math.random(),r]:[t,r]);return e.useMemo(()=>{i.forEach((h,y)=>i.set(y,!1))},[t]),e.useEffect(()=>{!t&&!i.size&&n&&n()},[t]),u==="popLayout"&&(o=x.jsx(G,{isPresent:t,children:o})),x.jsx(b.Provider,{value:d,children:o})};function V(){return new Map}const R=o=>o.key||"";function w(o){const s=[];return e.Children.forEach(o,t=>{e.isValidElement(t)&&s.push(t)}),s}const J=({children:o,custom:s,initial:t=!0,onExitComplete:n,presenceAffectsLayout:f=!0,mode:l="sync",propagate:u=!1})=>{const[i,p]=A(u),r=e.useMemo(()=>w(o),[o]),d=u&&!i?[]:r.map(R),h=e.useRef(!0),y=e.useRef(r),M=I(()=>new Map),[k,$]=e.useState(r),[m,L]=e.useState(r);D(()=>{h.current=!1,y.current=r;for(let a=0;a<m.length;a++){const c=R(m[a]);d.includes(c)?M.delete(c):M.get(c)!==!0&&M.set(c,!1)}},[m,d.length,d.join("-")]);const g=[];if(r!==k){let a=[...r];for(let c=0;c<m.length;c++){const C=m[c],v=R(C);d.includes(v)||(a.splice(c,0,C),g.push(C))}l==="wait"&&g.length&&(a=g),L(w(a)),$(r);return}const{forceRender:E}=e.useContext(B);return x.jsx(x.Fragment,{children:m.map(a=>{const c=R(a),C=u&&!i?!1:r===m||d.includes(c),v=()=>{if(M.has(c))M.set(c,!0);else return;let j=!0;M.forEach(F=>{F||(j=!1)}),j&&(E==null||E(),L(y.current),u&&(p==null||p()),n&&n())};return x.jsx(H,{isPresent:C,initial:!h.current||t?void 0:!1,custom:C?void 0:s,presenceAffectsLayout:f,mode:l,onExitComplete:C?void 0:v,children:a},c)})})};function N({children:o,features:s,strict:t=!1}){const[,n]=e.useState(!P(s)),f=e.useRef(void 0);if(!P(s)){const{renderer:l,...u}=s;f.current=l,z(u)}return e.useEffect(()=>{P(s)&&s().then(({renderer:l,...u})=>{z(u),f.current=l,n(!0)})},[]),x.jsx(K.Provider,{value:{renderer:f.current,strict:t},children:o})}function P(o){return typeof o=="function"}const W=O(),Q=T(W);export{J as A,N as L,Q as m};
