import{r as s,b as c,j as o}from"./app-1e18f165.js";import{u as T,S as N}from"./notistack.esm-5ab8ec6f.js";import F from"./AuditoriasUsers-e5579c82.js";import{d as U,a as z,b as C,m as g}from"./chunk-KQ5CH2X7-867295fa.js";import"./clsx.m-1229b3e0.js";import"./useMenuTriggerState-2cd95046.js";import"./SelectionManager-72778fb6.js";import"./FocusScope-34698c61.js";import"./focusSafely-0d0e41b4.js";import"./useCollator-f8b7b7a1.js";import"./getScrollParent-84ae6cc8.js";import"./useFocusable-37bc966c.js";import"./useControlledState-0b6c3be6.js";import"./useLocalizedStringFormatter-6dfb6611.js";import"./useOverlayTrigger-69319b45.js";import"./useOverlayPosition-f27a92c9.js";import"./useResizeObserver-1f814b9f.js";import"./useOverlayTriggerState-20dfbcae.js";import"./useDialog-1281e82d.js";import"./useLabels-bd056dc8.js";import"./VisuallyHidden-6788c411.js";import"./Overlay-e3689e7a.js";import"./index-df311c57.js";import"./chunk-UWE6H66T-10fe3d2c.js";import"./index-4be7962f.js";import"./chunk-GH5E4FQB-d59c17be.js";import"./index-20416e40.js";import"./chunk-MQ3ILONP-ea58cde4.js";import"./mergeRefs-2b78dc7b.js";import"./proxy-1822e291.js";import"./create-factory-27ee3d52.js";import"./useHover-fbcb60c8.js";import"./chunk-IHO36JMK-b3a8fe4a.js";import"./useTreeState-5f03c581.js";import"./index-f461d43a.js";import"./chunk-XJ3PDX4B-17cba00c.js";import"./chunk-6VC6TS2O-1d40f831.js";import"./chunk-UX7UMZL5-0433f114.js";const xe=()=>{const[l,d]=s.useState(null),{enqueueSnackbar:n}=T(),[f,p]=s.useState([]),[i,m]=s.useState(!1),[k,b]=s.useState(!1),[x,v]=s.useState(null),_=async()=>{const a="https://accounts.google.com/o/oauth2/auth?client_id=714516731386-9av4nplhrj4ssu4j79psumo7pur8unpl.apps.googleusercontent.com&redirect_uri=https://internal.meltec.com.co/auditoria&response_type=code&access_type=offline&prompt=consent&scope=https://www.googleapis.com/auth/drive.file";window.location.href=a},S=async()=>{const r=new URLSearchParams(window.location.search).get("code");if(console.log("este es el code que devuelve ",r),r)try{const t=await c.get(`https://internal.meltec.com.co/exchange-token?code=${r}`),{access_token:a,refresh_token:h}=t.data;console.log(t.data),a&&localStorage.setItem("access_token",a),h&&localStorage.setItem("refresh_token",h),alert("Autenticación completada con éxito.")}catch(t){console.error("Error al obtener los tokens:",t)}},w=()=>{n("No se pudo renovar el token de acceso.",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"center"},autoHideDuration:2100,style:{fontSize:17,color:"rgb(255, 255, 255)",marginTop:30,background:"rgba(255, 0, 0, 0.52)"}})},y=()=>{n("Error al refrescar el token.",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"center"},autoHideDuration:2100,style:{fontSize:17,color:"rgb(255, 255, 255)",marginTop:30,background:"rgba(255, 0, 0, 0.52)"}})},j=()=>{n("No se ha encontrado un refresh_token. Por favor, autentica primero. O comunicate con los desarrolladores para poder obtener permisos.",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"center"},autoHideDuration:2100,style:{fontSize:17,color:"rgb(255, 255, 255)",marginTop:30,background:"rgba(255, 0, 0, 0.52)"}})},u=async()=>{const e=localStorage.getItem("refresh_token");if(e)try{const r=await c.post("https://internal.meltec.com.co/refresh-token",{refresh_token:e});r.data.access_token?(localStorage.setItem("access_token",r.data.access_token),d(r.data.access_token)):(w(),console.log("datos recibidos al intentar renovar el token: ",r.data))}catch(r){console.error("Error al refrescar el token:",r),y()}else j()};s.useEffect(()=>{const e=localStorage.getItem("access_token");localStorage.setItem("refresh_token","1//058OGBxklT9XOCgYIARAAGAUSNwF-L9IrM24Hx4DgYBbfETA5qRHZdB2nySgdcMjvTHtSR3iQbElR_i7n-_3oyfveUak9XbDLutk"),console.log(localStorage.getItem("refresh_token")),e?d(e):S(),I()},[]);const I=async()=>{let e;const t=Date.now()>parseInt(3599,10);if(!e||t)try{if(await u(),e=localStorage.getItem("access_token"),!e){alert("No se pudo obtener un token válido.");return}}catch(a){alert("Error al renovar el token: "+a.message);return}try{const a=await c.post("https://internal.meltec.com.co/list-folders",{},{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${e}`}});a.data.folders?p(a.data.folders):p([])}catch(a){console.error("Error al listar archivos:",a)}},A=async e=>{console.log("Esta es la id del folder seleccionado",e);const r=localStorage.getItem("access_token");if(!r){console.error("Token de acceso no encontrado"),n("Token de acceso no encontrado, por favor inicie sesión.",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"center"},autoHideDuration:2e3});return}m([]);try{const t=await c.get(`/list-folders/subcarpetas/${e}`,{headers:{Authorization:`Bearer ${r}`}});console.log("necesito",t.data.subfolders),m(t.data.subfolders)}catch(t){console.error("Error al cargar los datos del modelo",t.response?t.response.data:t.message)}},E=async e=>{v(e),b(!0)};return o.jsx(N,{maxSnack:3,children:o.jsxs("div",{className:"my-5 mx-auto max-w-4xl bg-white overflow-hidden shadow-lg sm:rounded-lg p-8",children:[o.jsx("div",{className:"text-center mb-5",children:o.jsx("h2",{className:"text-2xl font-semibold text-gray-800",children:"Subir archivo a Google Drive"})}),o.jsxs("div",{className:"flex flex-col items-center border-2 border-gray-300 rounded-lg p-10",children:[!l&&o.jsx("button",{className:"px-6 py-3 mb-5 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none",onClick:_,children:"Autenticar con Google"}),l&&o.jsx(o.Fragment,{children:o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4",children:f.map((e,r)=>o.jsx("div",{className:"border rounded-lg p-4 shadow duration-300 hover:shadow-lg transition-shadow",children:o.jsxs(U,{children:[o.jsx(z,{children:o.jsx("button",{onClick:()=>A(e.id),variant:"bordered",children:e.folder_name})}),i?o.jsx(C,{"aria-label":"Static Actions",children:i.length>0?i.map((t,a)=>o.jsx(g,{onPress:()=>E(t.sub_id),children:t.subfolder_name},a)):o.jsx(g,{children:"No se encuentran carpetas disponibles"})}):o.jsx("p",{children:"Cargando carpetas ..."})]})},r))})}),k&&o.jsx(F,{refreshAccessToken:u,subFolderId:x})]})]})})};export{xe as default};
