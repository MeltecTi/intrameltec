import{b as E}from"./FocusScope-34698c61.js";import{r as m}from"./app-1e18f165.js";import{b as D}from"./useFocusable-37bc966c.js";import{i as g,g as O}from"./focusSafely-0d0e41b4.js";import{$ as P}from"./useControlledState-0b6c3be6.js";function w(o){let{ref:t,onInteractOutside:n,isDisabled:p,onInteractOutsideStart:l}=o,b=m.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}),a=g(r=>{n&&v(r,t)&&(l&&l(r),b.current.isPointerDown=!0)}),i=g(r=>{n&&n(r)});m.useEffect(()=>{let r=b.current;if(p)return;const $=t.current,s=O($);if(typeof PointerEvent<"u"){let f=c=>{r.isPointerDown&&v(c,t)&&i(c),r.isPointerDown=!1};return s.addEventListener("pointerdown",a,!0),s.addEventListener("pointerup",f,!0),()=>{s.removeEventListener("pointerdown",a,!0),s.removeEventListener("pointerup",f,!0)}}else{let f=d=>{r.ignoreEmulatedMouseEvents?r.ignoreEmulatedMouseEvents=!1:r.isPointerDown&&v(d,t)&&i(d),r.isPointerDown=!1},c=d=>{r.ignoreEmulatedMouseEvents=!0,r.isPointerDown&&v(d,t)&&i(d),r.isPointerDown=!1};return s.addEventListener("mousedown",a,!0),s.addEventListener("mouseup",f,!0),s.addEventListener("touchstart",a,!0),s.addEventListener("touchend",c,!0),()=>{s.removeEventListener("mousedown",a,!0),s.removeEventListener("mouseup",f,!0),s.removeEventListener("touchstart",a,!0),s.removeEventListener("touchend",c,!0)}}},[t,p,a,i])}function v(o,t){if(o.button>0)return!1;if(o.target){const n=o.target.ownerDocument;if(!n||!n.documentElement.contains(o.target)||o.target.closest("[data-react-aria-top-layer]"))return!1}return t.current&&!t.current.contains(o.target)}const u=[];function I(o,t){let{onClose:n,shouldCloseOnBlur:p,isOpen:l,isDismissable:b=!1,isKeyboardDismissDisabled:a=!1,shouldCloseOnInteractOutside:i}=o;m.useEffect(()=>(l&&u.push(t),()=>{let e=u.indexOf(t);e>=0&&u.splice(e,1)}),[l,t]);let r=()=>{u[u.length-1]===t&&n&&n()},$=e=>{(!i||i(e.target))&&u[u.length-1]===t&&(e.stopPropagation(),e.preventDefault())},s=e=>{(!i||i(e.target))&&(u[u.length-1]===t&&(e.stopPropagation(),e.preventDefault()),r())},f=e=>{e.key==="Escape"&&!a&&!e.nativeEvent.isComposing&&(e.stopPropagation(),e.preventDefault(),r())};w({ref:t,onInteractOutside:b&&l?s:void 0,onInteractOutsideStart:$});let{focusWithinProps:c}=D({isDisabled:!p,onBlurWithin:e=>{!e.relatedTarget||E(e.relatedTarget)||(!i||i(e.relatedTarget))&&(n==null||n())}}),d=e=>{e.target===e.currentTarget&&e.preventDefault()};return{overlayProps:{onKeyDown:f,...c},underlayProps:{onPointerDown:d}}}function M(o){let[t,n]=P(o.isOpen,o.defaultOpen||!1,o.onOpenChange);const p=m.useCallback(()=>{n(!0)},[n]),l=m.useCallback(()=>{n(!1)},[n]),b=m.useCallback(()=>{n(!t)},[n,t]);return{isOpen:t,setOpen:n,open:p,close:l,toggle:b}}export{I as $,M as a};
